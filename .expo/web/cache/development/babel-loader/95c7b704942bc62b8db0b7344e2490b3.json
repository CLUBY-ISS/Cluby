{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport { Platform, UnavailabilityError } from 'expo-modules-core';\nimport invariant from 'invariant';\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\n\nfunction getBasePath(_ref) {\n  var httpServerLocation = _ref.httpServerLocation;\n\n  if (httpServerLocation[0] === '/') {\n    return httpServerLocation.substr(1);\n  }\n\n  return httpServerLocation;\n}\n\nfunction getScale() {\n  return Dimensions.get('window').scale;\n}\n\nfunction getScaledAssetPath(asset) {\n  var scale = AssetSourceResolver.pickScale(asset.scales, getScale());\n  var scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';\n  var assetDir = getBasePath(asset);\n  return assetDir + '/' + asset.name + scaleSuffix + (asset.type ? \".\" + asset.type : '');\n}\n\nvar AssetSourceResolver = function () {\n  function AssetSourceResolver(serverUrl, jsbundleUrl, asset) {\n    _classCallCheck(this, AssetSourceResolver);\n\n    this.serverUrl = serverUrl;\n    this.jsbundleUrl = jsbundleUrl;\n    this.asset = asset;\n  }\n\n  _createClass(AssetSourceResolver, [{\n    key: \"isLoadedFromServer\",\n    value: function isLoadedFromServer() {\n      return !!this.serverUrl;\n    }\n  }, {\n    key: \"isLoadedFromFileSystem\",\n    value: function isLoadedFromFileSystem() {\n      return !!(this.jsbundleUrl && this.jsbundleUrl.startsWith('file://'));\n    }\n  }, {\n    key: \"defaultAsset\",\n    value: function defaultAsset() {\n      if (this.isLoadedFromServer()) {\n        return this.assetServerURL();\n      }\n\n      return this.scaledAssetURLNearBundle();\n    }\n  }, {\n    key: \"assetServerURL\",\n    value: function assetServerURL() {\n      invariant(!!this.serverUrl, 'need server to load from');\n      return this.fromSource(this.serverUrl + getScaledAssetPath(this.asset) + '?platform=' + Platform.OS + '&hash=' + this.asset.hash);\n    }\n  }, {\n    key: \"scaledAssetPath\",\n    value: function scaledAssetPath() {\n      return this.fromSource(getScaledAssetPath(this.asset));\n    }\n  }, {\n    key: \"scaledAssetURLNearBundle\",\n    value: function scaledAssetURLNearBundle() {\n      var path = this.jsbundleUrl || '';\n      return this.fromSource(path + getScaledAssetPath(this.asset));\n    }\n  }, {\n    key: \"resourceIdentifierWithoutScale\",\n    value: function resourceIdentifierWithoutScale() {\n      throw new UnavailabilityError('react-native', 'resourceIdentifierWithoutScale()');\n    }\n  }, {\n    key: \"drawableFolderInBundle\",\n    value: function drawableFolderInBundle() {\n      throw new UnavailabilityError('react-native', 'drawableFolderInBundle()');\n    }\n  }, {\n    key: \"fromSource\",\n    value: function fromSource(source) {\n      return {\n        __packager_asset: true,\n        width: this.asset.width,\n        height: this.asset.height,\n        uri: source,\n        scale: AssetSourceResolver.pickScale(this.asset.scales, getScale())\n      };\n    }\n  }], [{\n    key: \"pickScale\",\n    value: function pickScale(scales, deviceScale) {\n      for (var i = 0; i < scales.length; i++) {\n        if (scales[i] >= deviceScale) {\n          return scales[i];\n        }\n      }\n\n      return scales[scales.length - 1] || 1;\n    }\n  }]);\n\n  return AssetSourceResolver;\n}();\n\nexport { AssetSourceResolver as default };","map":{"version":3,"mappings":";;AAAA,SAASA,QAAT,EAAmBC,mBAAnB,QAA8C,mBAA9C;AACA,OAAOC,SAAP,MAAsB,WAAtB;;;AAeA,SAASC,WAAT,OAA0D;AAAA,MAAnCC,kBAAmC,QAAnCA,kBAAmC;;AACxD,MAAIA,kBAAkB,CAAC,CAAD,CAAlB,KAA0B,GAA9B,EAAmC;AACjC,WAAOA,kBAAkB,CAACC,MAAnB,CAA0B,CAA1B,CAAP;AACD;;AACD,SAAOD,kBAAP;AACD;;AAUD,SAASE,QAAT,GAAiB;AACf,SAAOC,UAAU,CAACC,GAAX,CAAe,QAAf,EAAyBC,KAAhC;AACD;;AAED,SAASC,kBAAT,CAA4BC,KAA5B,EAAiC;AAC/B,MAAMF,KAAK,GAAGG,mBAAmB,CAACC,SAApB,CAA8BF,KAAK,CAACG,MAApC,EAA4CR,QAAQ,EAApD,CAAd;AACA,MAAMS,WAAW,GAAGN,KAAK,KAAK,CAAV,GAAc,EAAd,GAAmB,MAAMA,KAAN,GAAc,GAArD;AACA,MAAMO,QAAQ,GAAGb,WAAW,CAACQ,KAAD,CAA5B;AACA,SAAOK,QAAQ,GAAG,GAAX,GAAiBL,KAAK,CAACM,IAAvB,GAA8BF,WAA9B,IAA6CJ,KAAK,CAACO,IAAN,SAAiBP,KAAK,CAACO,IAAvB,GAAgC,EAA7E,CAAP;AACD;;IAEoBN,mB;AAOnB,+BACEO,SADF,EAEEC,WAFF,EAGET,KAHF,EAGsB;AAAA;;AAEpB,SAAKQ,SAAL,GAAiBA,SAAjB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKT,KAAL,GAAaA,KAAb;AACD;;;;WACD,8BAAkB;AAChB,aAAO,CAAC,CAAC,KAAKQ,SAAd;AACD;;;WACD,kCAAsB;AACpB,aAAO,CAAC,EAAE,KAAKC,WAAL,IAAoB,KAAKA,WAAL,CAAiBC,UAAjB,CAA4B,SAA5B,CAAtB,CAAR;AACD;;;WACD,wBAAY;AACV,UAAI,KAAKC,kBAAL,EAAJ,EAA+B;AAC7B,eAAO,KAAKC,cAAL,EAAP;AACD;;AAED,aAAO,KAAKC,wBAAL,EAAP;AACD;;;WACD,0BAAc;AACZtB,eAAS,CAAC,CAAC,CAAC,KAAKiB,SAAR,EAAmB,0BAAnB,CAAT;AACA,aAAO,KAAKM,UAAL,CACL,KAAKN,SAAL,GACET,kBAAkB,CAAC,KAAKC,KAAN,CADpB,GAEE,YAFF,GAGEX,QAAQ,CAAC0B,EAHX,GAIE,QAJF,GAKE,KAAKf,KAAL,CAAWgB,IANR,CAAP;AAQD;;;WACD,2BAAe;AACb,aAAO,KAAKF,UAAL,CAAgBf,kBAAkB,CAAC,KAAKC,KAAN,CAAlC,CAAP;AACD;;;WACD,oCAAwB;AACtB,UAAMiB,IAAI,GAAG,KAAKR,WAAL,IAAoB,EAAjC;AACA,aAAO,KAAKK,UAAL,CAAgBG,IAAI,GAAGlB,kBAAkB,CAAC,KAAKC,KAAN,CAAzC,CAAP;AACD;;;WACD,0CAA8B;AAC5B,YAAM,IAAIV,mBAAJ,CAAwB,cAAxB,EAAwC,kCAAxC,CAAN;AACD;;;WACD,kCAAsB;AACpB,YAAM,IAAIA,mBAAJ,CAAwB,cAAxB,EAAwC,0BAAxC,CAAN;AACD;;;WACD,oBAAW4B,MAAX,EAAyB;AACvB,aAAO;AACLC,wBAAgB,EAAE,IADb;AAELC,aAAK,EAAE,KAAKpB,KAAL,CAAWoB,KAFb;AAGLC,cAAM,EAAE,KAAKrB,KAAL,CAAWqB,MAHd;AAILC,WAAG,EAAEJ,MAJA;AAKLpB,aAAK,EAAEG,mBAAmB,CAACC,SAApB,CAA8B,KAAKF,KAAL,CAAWG,MAAzC,EAAiDR,QAAQ,EAAzD;AALF,OAAP;AAOD;;;WAED,mBAAiBQ,MAAjB,EAAmCoB,WAAnC,EAAsD;AACpD,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrB,MAAM,CAACsB,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACtC,YAAIrB,MAAM,CAACqB,CAAD,CAAN,IAAaD,WAAjB,EAA8B;AAC5B,iBAAOpB,MAAM,CAACqB,CAAD,CAAb;AACD;AACF;;AACD,aAAOrB,MAAM,CAACA,MAAM,CAACsB,MAAP,GAAgB,CAAjB,CAAN,IAA6B,CAApC;AACD;;;;;;SAtEkBxB,mB","names":["Platform","UnavailabilityError","invariant","getBasePath","httpServerLocation","substr","getScale","Dimensions","get","scale","getScaledAssetPath","asset","AssetSourceResolver","pickScale","scales","scaleSuffix","assetDir","name","type","serverUrl","jsbundleUrl","startsWith","isLoadedFromServer","assetServerURL","scaledAssetURLNearBundle","fromSource","OS","hash","path","source","__packager_asset","width","height","uri","deviceScale","i","length"],"sourceRoot":"","sources":["../src/AssetSourceResolver.web.ts"],"sourcesContent":["import { Platform, UnavailabilityError } from 'expo-modules-core';\nimport invariant from 'invariant';\nimport { Dimensions } from 'react-native';\n\ntype PackagerAsset = {\n  __packager_asset: boolean;\n  fileSystemLocation: string;\n  httpServerLocation: string;\n  width?: number;\n  height?: number;\n  scales: number[];\n  hash: string;\n  name: string;\n  type: string;\n};\n\nfunction getBasePath({ httpServerLocation }: PackagerAsset): string {\n  if (httpServerLocation[0] === '/') {\n    return httpServerLocation.substr(1);\n  }\n  return httpServerLocation;\n}\n\nexport type ResolvedAssetSource = {\n  __packager_asset: boolean;\n  width?: number;\n  height?: number;\n  uri: string;\n  scale: number;\n};\n\nfunction getScale(): number {\n  return Dimensions.get('window').scale;\n}\n\nfunction getScaledAssetPath(asset): string {\n  const scale = AssetSourceResolver.pickScale(asset.scales, getScale());\n  const scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';\n  const assetDir = getBasePath(asset);\n  return assetDir + '/' + asset.name + scaleSuffix + (asset.type ? `.${asset.type}` : '');\n}\n\nexport default class AssetSourceResolver {\n  serverUrl?: string | null;\n  // where the jsbundle is being run from\n  jsbundleUrl?: string | null;\n  // the asset to resolve\n  asset: PackagerAsset;\n\n  constructor(\n    serverUrl: string | undefined | null,\n    jsbundleUrl: string | undefined | null,\n    asset: PackagerAsset\n  ) {\n    this.serverUrl = serverUrl;\n    this.jsbundleUrl = jsbundleUrl;\n    this.asset = asset;\n  }\n  isLoadedFromServer(): boolean {\n    return !!this.serverUrl;\n  }\n  isLoadedFromFileSystem(): boolean {\n    return !!(this.jsbundleUrl && this.jsbundleUrl.startsWith('file://'));\n  }\n  defaultAsset(): ResolvedAssetSource {\n    if (this.isLoadedFromServer()) {\n      return this.assetServerURL();\n    }\n\n    return this.scaledAssetURLNearBundle();\n  }\n  assetServerURL(): ResolvedAssetSource {\n    invariant(!!this.serverUrl, 'need server to load from');\n    return this.fromSource(\n      this.serverUrl +\n        getScaledAssetPath(this.asset) +\n        '?platform=' +\n        Platform.OS +\n        '&hash=' +\n        this.asset.hash\n    );\n  }\n  scaledAssetPath(): ResolvedAssetSource {\n    return this.fromSource(getScaledAssetPath(this.asset));\n  }\n  scaledAssetURLNearBundle(): ResolvedAssetSource {\n    const path = this.jsbundleUrl || '';\n    return this.fromSource(path + getScaledAssetPath(this.asset));\n  }\n  resourceIdentifierWithoutScale(): ResolvedAssetSource {\n    throw new UnavailabilityError('react-native', 'resourceIdentifierWithoutScale()');\n  }\n  drawableFolderInBundle(): ResolvedAssetSource {\n    throw new UnavailabilityError('react-native', 'drawableFolderInBundle()');\n  }\n  fromSource(source: string): ResolvedAssetSource {\n    return {\n      __packager_asset: true,\n      width: this.asset.width,\n      height: this.asset.height,\n      uri: source,\n      scale: AssetSourceResolver.pickScale(this.asset.scales, getScale()),\n    };\n  }\n\n  static pickScale(scales: number[], deviceScale: number): number {\n    for (let i = 0; i < scales.length; i++) {\n      if (scales[i] >= deviceScale) {\n        return scales[i];\n      }\n    }\n    return scales[scales.length - 1] || 1;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}